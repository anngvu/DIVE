data(volcano)
volcano
setwd("~/nPOD/nPOD-App/DIVE/Collection/Curated")
collection <- list.files(pattern = "*.txt")
cdata <- lapply(collection, function(x) fread(x))
iref <- sapply(strsplit(collection, "_|-|\\."), function(x) paste0(x[2], substr(x[3], nchar(x[3])-1, nchar(x[3]))))
# same variables from different studies distinguished by the source i
for(i in seq_along(cdata)) setnames(cdata[[i]], c("ID", paste0(iref[i], "_", names(cdata[[i]])[-1])))
cdata <- rbindlist(cdata, use.names = T, fill = T)
cdata <- cdata[, lapply(.SD, Agg), by = ID]
cdata <- Filter(is.numeric, cdata) # subset columns that actually have data, i.e. is numeric
cdata <- cdata[, grep("!", names(cdata), invert = T), with = F] # omit "!" columns
library(data.table)
Agg <- function(x) {
result <- unique(x[!is.na(x)])
# Note: returning first(x) is better than return(NA)
# because it will be the right kind of NA for the column
if(!length(result)) return(data.table::first(x)) else return(result)
}
# -- NON-HIGHTHROUGHPUT DATA ----------------------------------------------------------------------------------- #
# Combine collected data
collection <- list.files(pattern = "*.txt")
cdata <- lapply(collection, function(x) fread(x))
iref <- sapply(strsplit(collection, "_|-|\\."), function(x) paste0(x[2], substr(x[3], nchar(x[3])-1, nchar(x[3]))))
# same variables from different studies distinguished by the source i
for(i in seq_along(cdata)) setnames(cdata[[i]], c("ID", paste0(iref[i], "_", names(cdata[[i]])[-1])))
cdata <- rbindlist(cdata, use.names = T, fill = T)
cdata <- cdata[, lapply(.SD, Agg), by = ID]
cdata <- Filter(is.numeric, cdata) # subset columns that actually have data, i.e. is numeric
cdata <- cdata[, grep("!", names(cdata), invert = T), with = F] # omit "!" columns
head(cdata)
setwd("~/nPOD/nPOD-App/DIVE/Collection/Core")
aab <- fread("AutoAb_ref.tsv")
demog <- fread("Demographics_ref.tsv")
dinfo <- fread("DiabetesInfo_ref.tsv")
phased <- fread("phased_ref.tsv")
riskII <- fread("riskII_ref.txt")
# Merge all
cdata <- merge(cdata, aab, by = "ID", all.x = T, all.y = F)
cdata <- merge(cdata, demog, by = "ID", all.x = T, all.y = F)
cdata <- merge(cdata, dinfo, by = "ID", all.x = T, all.y = F)
cdata <- merge(cdata, phased, by = "ID", all.x = T, all.y = F)
cdata <- merge(cdata, riskII, by = "ID" all.x = T, all.y = F)
cdata <- merge(cdata, riskII, by = "ID", all.x = T, all.y = F)
setwd("~/nPOD/nPOD-App/DIVE/Data")
save(cdata, file = "cdata.Rdata")
setwd("~/nPOD/nPOD-App/DIVE")
source("helpers.R")
cor.data <- data2cor(cdata)
# Computing n
save(cor.data, file = "correlations.Rdata")
# Computing n
save(cor.data, file = "Data/correlations.Rdata")
